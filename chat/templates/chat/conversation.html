{% extends "chat/base.html" %}
{% block title %}{{ conversation.title }}{% endblock %}

{% block extra_head %}
<style>
.chat-container { max-width:900px; margin:0 auto; }
.messages { background:#fff; border-radius:10px; padding:20px; height:65vh; overflow:auto; box-shadow:0 2px 8px rgba(0,0,0,0.06); }
.msg { margin-bottom:14px; padding:12px 16px; border-radius:10px; max-width:80%; white-space:pre-wrap; }
.msg.user { background:#dff3ff; margin-left:auto; text-align:right; }
.msg.bot { background:#efefef; margin-right:auto; text-align:left; }
.input-row { display:flex; gap:8px; margin-top:12px; }
.input-row input[type="text"] { flex:1; padding:10px; border-radius:8px; border:1px solid #ccc; }
.input-row button { padding:10px 14px; border-radius:8px; background:#10a37f; color:white; border:none; cursor:pointer; }
.upload-box { margin-top:18px; background:#fff; padding:14px; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.06); }
</style>
{% endblock %}

{% block content %}
<div class="chat-container">
    <h2>{{ conversation.title }}</h2>

    <div class="messages" id="messages-box">
        {% include "chat/messages_list.html" %}
    </div>

    <form method="POST" class="input-row" style="margin-top:12px;">
        {% csrf_token %}
        <input type="text" name="text" placeholder="Type a message..." required>
        <button type="submit">Send</button>
    </form>

    <div class="upload-box">
        <h3>Upload Document</h3>
        <form method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            {{ upload_form.file }} &nbsp; {{ upload_form.title }}
            <button type="submit">Upload</button>
        </form>

        <h4 style="margin-top:12px;">Uploaded Files:</h4>
        <ul>
            {% for doc in documents %}
                <li><a href="{{ doc.file.url }}" target="_blank">{{ doc.title|default:doc.file.name }}</a></li>
            {% empty %}
                <li>No documents uploaded</li>
            {% endfor %}
        </ul>
    </div>
</div>

<script>
    // auto-scroll
    const box = document.getElementById("messages-box");
    if (box) box.scrollTop = box.scrollHeight;
</script>
{% endblock %}
